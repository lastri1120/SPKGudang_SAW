<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>SPK Gudang - Metode SAW</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <style>
    .section { display: none; }
    .section.active { display: block; }
    .menu.active { background-color: #a855f7; }
  </style>
</head>
<body class="flex min-h-screen bg-gray-100">

<div id="overlay" class="fixed inset-0 bg-black bg-opacity-40 z-50 hidden"></div>

<aside class="w-64 bg-purple-800 text-white flex flex-col">
  <div class="p-6 font-bold text-xl">SPK Gudang<br><span class="text-sm">Metode SAW</span></div>
  <nav class="flex-1 space-y-1 px-4">
    <button class="menu active w-full text-left px-4 py-2 rounded" onclick="showSection('dashboard')" id="nav-dashboard">Dashboard</button>
    <button class="menu w-full text-left px-4 py-2 rounded" onclick="showSection('penjualan')" id="nav-penjualan">Data Penjualan</button>
    <button class="menu w-full text-left px-4 py-2 rounded" onclick="showSection('cabang')" id="nav-cabang">Data Cabang</button>
    <button class="menu w-full text-left px-4 py-2 rounded" onclick="showSection('kriteria')" id="nav-kriteria">Kriteria & Bobot</button>
    <button class="menu w-full text-left px-4 py-2 rounded" onclick="showSection('hasil')" id="nav-hasil">Hasil SAW</button>
  </nav>
</aside>

<main class="flex-1 p-8">

<section id="dashboard" class="section active">
  <h1 class="text-2xl font-bold mb-6">Dashboard SPK Gudang</h1>
  <div class="grid grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded shadow p-4 text-center">
      <h5 class="font-bold text-lg">Total Cabang</h5>
      <p id="totalCabang" class="text-2xl text-purple-600">0</p>
    </div>
    <div class="bg-white rounded shadow p-4 text-center">
      <h5 class="font-bold text-lg">Total Penjualan</h5>
      <p id="totalPenjualan" class="text-2xl text-purple-600">0</p>
    </div>
    <div class="bg-white rounded shadow p-4 text-center">
      <h5 class="font-bold text-lg">Total Kriteria</h5>
      <p id="totalKriteria" class="text-2xl text-purple-600">0</p>
    </div>
  </div>

  <button onclick="runHitungSAW('dashboard')" class="bg-purple-600 text-white px-4 py-2 rounded mb-4">Mulai Hitung SAW</button>

  <table class="w-full bg-white rounded shadow border text-sm mt-4">
    <thead class="bg-purple-200">
      <tr>
        <th class="p-2">Ranking</th>
        <th class="p-2">Cabang</th>
        <th class="p-2">Nilai</th>
      </tr>
    </thead>
    <tbody id="dashboard-ranking-body"></tbody>
  </table>
</section>

  <!-- DATA PENJUALAN -->
 <section id="penjualan" class="section">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">Data Penjualan</h1>
    <button onclick="showPenjualanForm()" class="bg-blue-600 text-white px-4 py-2 rounded">+ Tambah Data</button>
  </div>

  <div id="penjualan-list" class="bg-white rounded shadow p-4">
    <table class="w-full border text-sm">
      <thead class="bg-purple-600 text-white">
        <tr>
          <th class="p-2">No</th>
          <th class="p-2">Cabang</th>
          <th class="p-2">Produk</th>
          <th class="p-2">Jumlah</th>
          <th class="p-2">Aksi</th>
        </tr>
      </thead>
      <tbody id="listPenjualan">
        <tr><td colspan="5" class="text-center p-4 text-gray-400">Memuat data...</td></tr>
      </tbody>
    </table>
  </div>

  <div id="penjualan-form" class="hidden bg-white rounded shadow p-6">
    <div class="flex justify-between mb-4">
      <h3 class="text-lg font-bold">Form Penjualan</h3>
      <button onclick="showPenjualanList()" class="bg-gray-500 text-white px-3 py-1 rounded">← Kembali</button>
    </div>

    <input type="hidden" id="penjualan_id">

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label>Cabang</label>
        <select id="cabangJual" class="w-full border p-2 rounded">
          <option value="">-- Pilih Cabang --</option>
        </select>
      </div>
      <div>
        <label>Produk</label>
        <input id="produkJual" class="w-full border p-2 rounded">
      </div>
      <div>
        <label>Jumlah Terjual</label>
        <input type="number" id="jumlahJual" class="w-full border p-2 rounded">
      </div>
    </div>

    <div class="mt-6 flex justify-end gap-2">
      <button onclick="tambahPenjualan()" class="bg-blue-600 text-white px-6 py-2 rounded">Simpan</button>
      <button onclick="resetPenjualanForm()" class="bg-gray-400 text-white px-6 py-2 rounded">Reset</button>
    </div>
  </div>
</section>

  <!-- DATA CABANG -->
  <section id="cabang" class="section">
    <h1 class="text-2xl font-bold mb-4">Data Cabang</h1>
    <button onclick="showFormCabang()" class="bg-green-600 text-white px-4 py-2 rounded mb-3">
  Tambah Cabang
</button>
    <table class="w-full bg-white rounded shadow text-sm border">
      <thead class="bg-purple-600 text-white">
        <tr>
          <th class="p-2">No</th>
          <th class="p-2">Kode Cabang</th>
          <th class="p-2">Nama Cabang</th>
          <th class="p-2">Alamat</th>
          <th class="p-2">Aksi</th>
        </tr>
      </thead>
      <tbody id="tblCabang"></tbody>
    </table>
    <div id="formCabang" class="hidden bg-white rounded shadow p-6">
    <div class="flex justify-between mb-4">
      <h3 class="text-lg font-bold text-blue-600">Form Cabang</h3>
      <button onclick="showCabangList()" class="bg-gray-500 text-white px-3 py-1 rounded">← Kembali</button>
    </div>

    <input type="hidden" id="cabang_id">

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label>Kode Cabang</label>
        <input id="kodeCabang" class="w-full border p-2 rounded" placeholder="CB01">
      </div>
      <div>
        <label>Nama Cabang</label>
        <input id="namaCabang" class="w-full border p-2 rounded" placeholder="Cabang Jakarta">
      </div>
      <div class="col-span-2">
        <label>Alamat</label>
        <textarea id="alamatCabang" class="w-full border p-2 rounded" placeholder="Alamat cabang"></textarea>
      </div>
    </div>

    <div class="mt-6 flex justify-end gap-2">
      <button onclick="tambahCabang()" class="bg-blue-600 text-white px-6 py-2 rounded">Simpan</button>
      <button onclick="resetCabangForm()" class="bg-gray-400 text-white px-6 py-2 rounded">Reset</button>
    </div>
  </div>
</div>
  </section>


  <!-- DATA KRITERIA -->
  <section id="kriteria" class="section">
    <h1 class="text-2xl font-bold mb-4">Data Kriteria</h1>
    <button onclick="showFormKriteria()" class="bg-green-600 text-white px-4 py-2 rounded mb-3">
  Tambah Kriteria
</button>
    <table class="w-full bg-white rounded shadow text-sm border">
      <thead class="bg-blue-600 text-white">
        <tr>
          <th class="p-2">No</th>
          <th class="p-2">Kode</th>
          <th class="p-2">Nama Kriteria</th>
          <th class="p-2">Type</th>
          <th class="p-2">Bobot</th>
          <th class="p-2">Cara Penilaian</th>
          <th class="p-2">Aksi</th>
        </tr>
      </thead>
      <tbody id="tblKriteria"></tbody>
    </table>
        <div id="formKriteria" class="hidden bg-white rounded shadow p-6">
    <div class="flex justify-between mb-4">
      <h3 class="text-lg font-bold text-blue-600">Form Kriteria</h3>
      <button onclick="showKriteriaList()" class="bg-gray-500 text-white px-3 py-1 rounded">← Kembali</button>
    </div>

    <input type="hidden" id="kriteria_id">

    <div class="grid grid-cols-2 gap-4">
      <div>
        <label>Kode Kriteria</label>
        <input id="kodeKriteria" class="w-full border p-2 rounded">
      </div>
      <div>
        <label>Nama Kriteria</label>
        <input id="namaKriteria" class="w-full border p-2 rounded">
      </div>
      <div>
        <label>Type</label>
        <select id="tipeKriteria" class="w-full border p-2 rounded">
          <option value="">-- Pilih Type --</option>
          <option value="benefit">Benefit</option>
          <option value="cost">Cost</option>
        </select>
      </div>
      <div>
        <label>Bobot</label>
        <input type="number" step="0.01" id="bobotKriteria" class="w-full border p-2 rounded">
      </div>
      <div class="col-span-2">
        <label>Cara Penilaian</label>
        <input id="caraKriteria" class="w-full border p-2 rounded">
      </div>
    </div>

    <div class="mt-6 flex justify-end gap-2">
      <button onclick="tambahKriteria()" class="bg-blue-600 text-white px-6 py-2 rounded">Simpan</button>
      <button onclick="resetKriteriaForm()" class="bg-gray-400 text-white px-6 py-2 rounded">Reset</button>
    </div>
  </div>
  </section>

  <!-- HASIL SAW -->
  <section id="hasil" class="section">
    <h1 class="text-2xl font-bold mb-4">Hasil SAW</h1>
    <table class="w-full bg-white rounded shadow border text-sm">
      <thead class="bg-purple-200">
        <tr>
          <th class="p-2">Ranking</th>
          <th class="p-2">Cabang</th>
          <th class="p-2">Nilai</th>
        </tr>
      </thead>
      <tbody id="ranking-body"></tbody>
    </table>
  </section>

</main>

<script>
const BACKEND_URL = "https://<railway-backend-url>.up.railway.app";

const API_CABANG = BACKEND_URL + "/api/cabang";
const API_PENJUALAN = BACKEND_URL + "/api/penjualan";
const API_KRITERIA = BACKEND_URL + "/api/kriteria";
const API_SAW = BACKEND_URL + "/api/saw";


function showSection(sec) {
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.getElementById(sec).classList.add("active");
}

async function loadCabang() {
  const res = await fetch(API_CABANG);
  const rows = await res.json();

  const select = document.getElementById("cabangJual");
  select.innerHTML = `<option value="">-- Pilih Cabang --</option>`;
  rows.forEach(c => {
    select.innerHTML += `<option value="${c.id}">${c.nama}</option>`;
  });

  const tbody = document.getElementById("tblCabang");
  tbody.innerHTML = "";
  rows.forEach((c, i) => {
    tbody.innerHTML += `
      <tr>
        <td class="border p-2">${i + 1}</td>
        <td class="border p-2">${c.id}</td>
        <td class="border p-2">${c.nama}</td>
        <td class="border p-2">${c.lokasi || '-'}</td>
        <td class="border p-2 text-center">
          <button onclick="editCabang(${c.id})" class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button>
          <button onclick="hapusCabang(${c.id})" class="bg-red-600 text-white px-2 py-1 rounded">Hapus</button>
        </td>
      </tr>`;
  });

  document.getElementById("totalCabang").innerText = rows.length;
}

async function tambahCabang() {
  const nama = document.getElementById("namaCabang").value;
  const lokasi = document.getElementById("lokasiCabang").value;

  if (!nama) return alert("Nama harus diisi!");

  const res = await fetch(API_CABANG, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ nama, lokasi })
  });

  const r = await res.json();
  alert(r.message);
  loadCabang();
}

async function hapusCabang(id) {
  if (!confirm("Yakin hapus?")) return;
  const res = await fetch(API_CABANG + "/" + id, { method: "DELETE" });
  const r = await res.json();
  alert(r.message);
  loadCabang();
}

async function loadPenjualan() {
  const res = await fetch(API_PENJUALAN);
  const rows = await res.json();
  const tbody = document.getElementById("listPenjualan");
  tbody.innerHTML = "";

  rows.forEach((p, i) => {
    tbody.innerHTML += `
      <tr>
        <td class="border p-2">${i + 1}</td>
        <td class="border p-2">${p.cabang_id}</td>
        <td class="border p-2">${p.total_penjualan}</td>
        <td class="border p-2">${p.produk_terjual}</td>
        <td class="border p-2">
          <button onclick="editPenjualan(${p.id})" class="bg-yellow-500 text-white px-2 py-1 rounded">Edit</button>
          <button onclick="hapusPenjualan(${p.id})" class="bg-red-600 text-white px-2 py-1 rounded">Hapus</button>
        </td>
      </tr>`;
  });

  document.getElementById("totalPenjualan").innerText =
    rows.reduce((sum, x) => sum + x.total_penjualan, 0);
}

async function tambahPenjualan() {
  const cabang = document.getElementById("cabangJual").value;
  const produk = document.getElementById("produkJual").value;
  const jumlah = document.getElementById("jumlahJual").value;

  if (!cabang || !produk || !jumlah) return alert("Isi semua!");

  const res = await fetch(API_PENJUALAN, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ cabang_id: cabang, produk, jumlah })
  });

  const r = await res.json();
  alert(r.message);
  loadPenjualan();
}

async function runHitungSAW() {
  const res = await fetch(API_SAW + "/hitung", { method: "POST" });
  const data = await res.json();

  const tbody = document.getElementById("ranking-body");
  tbody.innerHTML = "";
  data.ranking.forEach((r, i) => {
    tbody.innerHTML += `
      <tr>
        <td class="border p-2">${i + 1}</td>
        <td class="border p-2">${r.cabang}</td>
        <td class="border p-2">${r.nilai}</td>
      </tr>`;
  });
}

window.onload = () => {
  loadCabang();
  loadPenjualan();
  loadKriteria();
};
</script>

</body>
</html>

